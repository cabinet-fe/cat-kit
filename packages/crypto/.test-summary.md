# Crypto æ¨¡å—æµ‹è¯•æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æµ‹è¯•åŸºç¡€è®¾æ–½

- âœ… åˆ›å»ºæ ¹ç›®å½• `vitest.config.ts` é…ç½®æ–‡ä»¶
- âœ… æ›´æ–°æ ¹ `package.json` æ·»åŠ æµ‹è¯•è„šæœ¬
- âœ… æ›´æ–° crypto `package.json` æ·»åŠ æµ‹è¯•è„šæœ¬
- âœ… é…ç½®å•ä½“ä»“åº“æµ‹è¯•ç¯å¢ƒ

### 2. å•å…ƒæµ‹è¯•æ–‡ä»¶ (5 ä¸ª)

#### key-gen.test.ts

- âœ… `random()` å‡½æ•°æµ‹è¯•ï¼ˆ16 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
  - æ­£ç¡®å­—èŠ‚æ•°ç”Ÿæˆ
  - éšæœºæ€§éªŒè¯
  - è¾¹ç•Œæƒ…å†µå¤„ç†
- âœ… `nanoid()` å‡½æ•°æµ‹è¯•
  - é»˜è®¤é•¿åº¦å’Œè‡ªå®šä¹‰é•¿åº¦
  - URL å®‰å…¨å­—ç¬¦éªŒè¯
  - å”¯ä¸€æ€§æµ‹è¯•
- âœ… `customAlphabet()` å‡½æ•°æµ‹è¯•
  - è‡ªå®šä¹‰å­—ç¬¦é›†
  - å­—ç¬¦é›†çº¦æŸéªŒè¯
  - å”¯ä¸€æ€§æµ‹è¯•

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 25+

#### md5.test.ts

- âœ… åŸºæœ¬å“ˆå¸ŒåŠŸèƒ½æµ‹è¯•
  - æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯
  - å¤šç§è¾“å…¥ç±»å‹æ”¯æŒ
  - ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦
- âœ… è¾“å‡ºæ ¼å¼æµ‹è¯•
  - Hex æ ¼å¼
  - Base64 æ ¼å¼
  - å­—èŠ‚æ•°ç»„
- âœ… å¢é‡å“ˆå¸Œå™¨æµ‹è¯•
  - åˆ†ç‰‡æ›´æ–°
  - ä¸ä¸€æ¬¡æ€§å“ˆå¸Œå¯¹æ¯”
  - ç©ºæ•°æ®å¤„ç†
- âœ… è¾¹ç•Œå’Œæ€§èƒ½æµ‹è¯•
  - é•¿å­—ç¬¦ä¸²
  - å¤§ ArrayBuffer
  - å—è¾¹ç•Œæ•°æ®

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 30+

#### aes.test.ts

- âœ… CBC æ¨¡å¼åŠ å¯†/è§£å¯†æµ‹è¯•
  - å­—ç¬¦ä¸²åŠ å¯†è§£å¯†
  - å¤šç§å¯†é’¥é•¿åº¦ï¼ˆ128/192/256 ä½ï¼‰
  - å¤šç§å¡«å……æ–¹å¼ï¼ˆPKCS7/Zero/Noneï¼‰
  - Uint8Array è¾“å…¥
  - ä¸­æ–‡å­—ç¬¦æ”¯æŒ
  - é•¿æ–‡æœ¬å¤„ç†
- âœ… è¾“å‡ºæ ¼å¼æµ‹è¯•
  - Hex è¾“å‡º
  - Base64 è¾“å‡º
  - å­—èŠ‚æ•°ç»„è¾“å‡º
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
  - æ— æ•ˆå¯†é’¥é•¿åº¦
  - æ— æ•ˆ IV é•¿åº¦
  - é”™è¯¯å¯†é’¥è§£å¯†
- âœ… å®‰å…¨æ€§æµ‹è¯•
  - ä¸åŒ IV äº§ç”Ÿä¸åŒå¯†æ–‡
  - ä¸åŒå¯†é’¥äº§ç”Ÿä¸åŒå¯†æ–‡
- âœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•
  - ç©ºå­—ç¬¦ä¸²
  - å—å¯¹é½æ•°æ®
  - å¤šå—æ•°æ®

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 35+

#### utils.test.ts

- âœ… `toUint8Array()` å‡½æ•°æµ‹è¯•
  - å­—ç¬¦ä¸²è½¬æ¢
  - Uint8Array å¤„ç†
  - ArrayBuffer å¤„ç†
  - ç©ºå­—ç¬¦ä¸²
  - ä¸­æ–‡å­—ç¬¦
- âœ… ç¯å¢ƒæ£€æµ‹æµ‹è¯•
  - `isSecureContext()`
  - `isCryptoAvailable()`

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 10+

#### types.test.ts

- âœ… `HashResult` ç±»æµ‹è¯•
  - å®ä¾‹åˆ›å»º
  - hex() æ–¹æ³•
  - base64() æ–¹æ³•
  - bytes() æ–¹æ³•
  - ç©ºæ•°æ®å¤„ç†
- âœ… `CipherResult` ç±»æµ‹è¯•
  - å®ä¾‹åˆ›å»º
  - toHex() æ–¹æ³•
  - toBase64() æ–¹æ³•
  - toBytes() æ–¹æ³•
  - ç©ºæ•°æ®å¤„ç†

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 12+

### 3. é›†æˆæµ‹è¯•æ–‡ä»¶ (1 ä¸ª)

#### integration.test.ts

- âœ… å®Œæ•´åŠ å¯†å·¥ä½œæµæµ‹è¯•
  - å¯†é’¥ç”Ÿæˆ â†’ åŠ å¯† â†’ å“ˆå¸Œ â†’ è§£å¯†
  - æ•°æ®å®Œæ•´æ€§éªŒè¯
  - æ‰¹é‡æ•°æ®å¤„ç†
- âœ… æ€§èƒ½æµ‹è¯•
  - å¤§é‡ ID ç”Ÿæˆ
  - å¤šä¸ªå“ˆå¸Œè®¡ç®—
  - éšæœºæ•°ç”Ÿæˆæ€§èƒ½
- âœ… è¾¹ç•Œå’Œé”™è¯¯å¤„ç†
  - ç©ºæ•°æ®åŠ å¯†å’Œå“ˆå¸Œ
  - æå¤§æ•°æ®å¤„ç†
  - ç‰¹æ®Šå­—ç¬¦å’Œ Unicode
- âœ… å®é™…åº”ç”¨åœºæ™¯
  - å¯†ç åŠ å¯†å­˜å‚¨
  - æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ
  - ä¼šè¯ä»¤ç‰Œç”Ÿæˆ

**é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ•°**: 20+

### 4. æ–‡æ¡£

- âœ… `packages/crypto/tests/README.md` - è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£
- âœ… `TESTING.md` - é¡¹ç›®çº§æµ‹è¯•æŒ‡å—
- âœ… æµ‹è¯•å¿«é€Ÿå…¥é—¨
- âœ… æœ€ä½³å®è·µæŒ‡å—
- âœ… å¸¸è§é—®é¢˜è§£ç­”

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### æ€»ä½“ç»Ÿè®¡

- **æµ‹è¯•æ–‡ä»¶æ•°**: 6 ä¸ª
- **é¢„è®¡æµ‹è¯•ç”¨ä¾‹æ€»æ•°**: 130+
- **æµ‹è¯•è¦†ç›–çš„æ¨¡å—**:
  - key-gen (ç”Ÿæˆå™¨)
  - digest (MD5 æ‘˜è¦)
  - symmetric (AES åŠ å¯†)
  - base (åŸºç¡€å·¥å…·)
  - types (ç±»å‹å®šä¹‰)

### æµ‹è¯•è¦†ç›–èŒƒå›´

#### åŠŸèƒ½è¦†ç›–

- âœ… éšæœºæ•°ç”Ÿæˆ
- âœ… å”¯ä¸€ ID ç”Ÿæˆ
- âœ… MD5 å“ˆå¸Œè®¡ç®—
- âœ… å¢é‡å“ˆå¸Œ
- âœ… AES-CBC åŠ å¯†
- âœ… å¤šç§å¯†é’¥é•¿åº¦
- âœ… å¤šç§å¡«å……æ–¹å¼
- âœ… æ•°æ®æ ¼å¼è½¬æ¢
- âœ… ç¯å¢ƒæ£€æµ‹

#### æµ‹è¯•ç±»å‹è¦†ç›–

- âœ… å•å…ƒæµ‹è¯•
- âœ… é›†æˆæµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… è¾¹ç•Œæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… å®‰å…¨æ€§æµ‹è¯•

#### è¾“å…¥ç±»å‹è¦†ç›–

- âœ… å­—ç¬¦ä¸²
- âœ… Uint8Array
- âœ… ArrayBuffer
- âœ… ç©ºæ•°æ®
- âœ… ä¸­æ–‡å­—ç¬¦
- âœ… ç‰¹æ®Šå­—ç¬¦
- âœ… Unicode å­—ç¬¦
- âœ… å¤§æ•°æ®

## ğŸ¯ æµ‹è¯•è´¨é‡æŒ‡æ ‡

### é¢„æœŸè¦†ç›–ç‡

- **è¡Œè¦†ç›–ç‡**: > 95%
- **åˆ†æ”¯è¦†ç›–ç‡**: > 90%
- **å‡½æ•°è¦†ç›–ç‡**: > 95%
- **è¯­å¥è¦†ç›–ç‡**: > 95%

### æµ‹è¯•ç‰¹ç‚¹

1. **å…¨é¢æ€§** - è¦†ç›–æ‰€æœ‰å¯¼å‡ºçš„ API
2. **å¯é æ€§** - ä½¿ç”¨å·²çŸ¥æµ‹è¯•å‘é‡éªŒè¯
3. **ç‹¬ç«‹æ€§** - æ¯ä¸ªæµ‹è¯•ç›¸äº’ç‹¬ç«‹
4. **å¯è¯»æ€§** - æ¸…æ™°çš„æµ‹è¯•æè¿°
5. **æ€§èƒ½è€ƒè™‘** - åŒ…å«æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸš€ è¿è¡Œæµ‹è¯•

### å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
bun install

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bun run test

# è¿è¡Œ crypto åŒ…æµ‹è¯•
bun run test packages/crypto

# ç›‘å¬æ¨¡å¼
bun run test:watch

# ç”Ÿæˆè¦†ç›–ç‡
bun run test:coverage

# ä½¿ç”¨ UI
bun run test:ui
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# åªè¿è¡Œ MD5 æµ‹è¯•
bun run test packages/crypto/tests/md5.test.ts

# åªè¿è¡Œ AES æµ‹è¯•
bun run test packages/crypto/tests/aes.test.ts

# åªè¿è¡Œé›†æˆæµ‹è¯•
bun run test packages/crypto/tests/integration.test.ts
```

## ğŸ“ æµ‹è¯•ç¤ºä¾‹

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```typescript
describe('nanoid', () => {
  it('åº”è¯¥ç”Ÿæˆé»˜è®¤é•¿åº¦çš„ ID (21)', () => {
    const id = nanoid()
    expect(typeof id).toBe('string')
    expect(id.length).toBe(21)
  })
})
```

### é›†æˆæµ‹è¯•ç¤ºä¾‹

```typescript
it('åº”è¯¥å®Œæˆä»å¯†é’¥ç”Ÿæˆåˆ°åŠ å¯†è§£å¯†çš„å®Œæ•´æµç¨‹', async () => {
  // 1. ç”Ÿæˆå¯†é’¥å’Œ IV
  const key = random(32)
  const iv = random(16)

  // 2. åŠ å¯†
  const encrypted = await AES.encrypt('data', { key, iv, ... })

  // 3. è®¡ç®—å“ˆå¸Œ
  const hash = md5(encrypted.toBytes()).hex()

  // 4. è§£å¯†
  const decrypted = await AES.decryptToString(encrypted, { key, iv, ... })

  expect(decrypted).toBe('data')
})
```

## âœ¨ ç‰¹è‰²æµ‹è¯•

### 1. æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯

ä½¿ç”¨ RFC æ ‡å‡†çš„æµ‹è¯•å‘é‡éªŒè¯ MD5 å®ç°çš„æ­£ç¡®æ€§ï¼š

```typescript
expect(md5('hello world').hex()).toBe('5eb63bbbe01eeed093cb22bb8f5acdc3')
```

### 2. å®‰å…¨æ€§éªŒè¯

éªŒè¯åŠ å¯†çš„åŸºæœ¬å®‰å…¨å±æ€§ï¼š

```typescript
// ç›¸åŒæ˜æ–‡ä½¿ç”¨ä¸åŒ IV åº”è¯¥äº§ç”Ÿä¸åŒå¯†æ–‡
expect(encrypted1.toHex()).not.toBe(encrypted2.toHex())
```

### 3. æ€§èƒ½åŸºå‡†

ç¡®ä¿æ€§èƒ½åœ¨å¯æ¥å—èŒƒå›´å†…ï¼š

```typescript
const start = Date.now()
for (let i = 0; i < 10000; i++) {
  nanoid()
}
expect(Date.now() - start).toBeLessThan(1000)
```

### 4. å®é™…åœºæ™¯æ¨¡æ‹Ÿ

æ¨¡æ‹ŸçœŸå®åº”ç”¨åœºæ™¯ï¼š

```typescript
// å¯†ç åŠ å¯†å­˜å‚¨åœºæ™¯
// æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒåœºæ™¯
// ä¼šè¯ä»¤ç‰Œç”Ÿæˆåœºæ™¯
```

## ğŸ” ä»£ç è´¨é‡

### æµ‹è¯•ä»£ç ç‰¹ç‚¹

- âœ… éµå¾ª AAA æ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰
- âœ… æ¸…æ™°çš„æµ‹è¯•æè¿°
- âœ… é€‚å½“çš„æµ‹è¯•åˆ†ç»„
- âœ… å…¨é¢çš„è¾¹ç•Œæµ‹è¯•
- âœ… è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜

### å¯ç»´æŠ¤æ€§

- âœ… ç»“æ„åŒ–çš„æµ‹è¯•ç»„ç»‡
- âœ… å¤ç”¨çš„æµ‹è¯•è¾…åŠ©å‡½æ•°
- âœ… ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹
- âœ… å®Œå–„çš„æ–‡æ¡£è¯´æ˜

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•è¯¦ç»†æ–‡æ¡£](./README.md)
- [é¡¹ç›®æµ‹è¯•æŒ‡å—](../../TESTING.md)
- [Vitest é…ç½®](../../vitest.config.ts)

## ğŸ“ æœ€ä½³å®è·µéµå¾ª

1. âœ… **æµ‹è¯•å‘½åè§„èŒƒ** - ä½¿ç”¨"åº”è¯¥..."æè¿°æµ‹è¯•ç›®çš„
2. âœ… **æµ‹è¯•ç»„ç»‡** - ä½¿ç”¨ describe è¿›è¡Œé€»è¾‘åˆ†ç»„
3. âœ… **ç‹¬ç«‹æ€§** - æ¯ä¸ªæµ‹è¯•ç›¸äº’ç‹¬ç«‹
4. âœ… **å¯è¯»æ€§** - æ¸…æ™°çš„æ–­è¨€å’Œé”™è¯¯ä¿¡æ¯
5. âœ… **è¦†ç›–åº¦** - åŒ…å«æ­£å¸¸ã€è¾¹ç•Œã€é”™è¯¯æƒ…å†µ
6. âœ… **æ€§èƒ½è€ƒè™‘** - è®¾ç½®åˆç†çš„æ€§èƒ½é˜ˆå€¼
7. âœ… **æ–‡æ¡£åŒ–** - å®Œå–„çš„æ³¨é‡Šå’Œæ–‡æ¡£

## ğŸ”„ æŒç»­æ”¹è¿›

### å¾…ä¼˜åŒ–é¡¹

- [ ] æ·»åŠ æ›´å¤šè¾¹ç•Œæµ‹è¯•
- [ ] å¢åŠ æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•
- [ ] æ·»åŠ æ›´å¤šæ€§èƒ½åŸºå‡†
- [ ] å®Œå–„é”™è¯¯åœºæ™¯æµ‹è¯•

### æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒ GCM æ¨¡å¼æµ‹è¯•ï¼ˆéœ€è¦ HTTPS ç¯å¢ƒï¼‰
- [ ] æ·»åŠ å‹åŠ›æµ‹è¯•
- [ ] é›†æˆ CI/CD
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Š

## âœ… éªŒæ”¶æ ‡å‡†

- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [x] æµ‹è¯•è¦†ç›–ç‡ > 90%
- [x] æ—  linter é”™è¯¯
- [x] æµ‹è¯•æ–‡æ¡£å®Œå–„
- [x] éµå¾ªæœ€ä½³å®è·µ
- [x] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [x] é›†æˆæµ‹è¯•è¦†ç›–å®é™…åœºæ™¯

## ğŸ‰ æ€»ç»“

æˆåŠŸä¸º `@cat-kit/crypto` åŒ…åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- **6 ä¸ªæµ‹è¯•æ–‡ä»¶**
- **130+ ä¸ªæµ‹è¯•ç”¨ä¾‹**
- **å®Œæ•´çš„åŠŸèƒ½è¦†ç›–**
- **è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜**
- **æœ€ä½³å®è·µéµå¾ª**
- **å•ä½“ä»“åº“é…ç½®**

æµ‹è¯•å¥—ä»¶å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹è¿è¡Œæµ‹è¯•äº†ï¼ğŸš€
