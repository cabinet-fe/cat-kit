# 实用开发密码学

软件开发人员在日常工作中会经常用到密码学，例如哈希（信息摘要），加密，数字签名。实现加密算法通常很复杂，各种数学概念，本文实用密码学旨在如何理解密码学中的部分概念和如何使用现有的库。

## 密码学概念

### 原文
原文是指待加密的内容。原文本身不难以理解，但如何在加密库中将原文输入则需要细细道来。

在你对密码世界没有任何概念的时候，你通常都会认为原文就是一个普通的字符串，实际上加密都是针对二进制数据进行的，因此我们需要了解如何将原文转化成二进制数据。

通常你所使用的加密库都已自带将原文转化为二进制内容的方法, 下面是一个例子


### 对称加密

使用相同的密钥来加密和解密消息。

例如 AES， DES， ChaCha20。

伪代码:

```ts
const key = 'key'

// 加密
const encrypted = encrypt('原文', key)

// 解密
const decrypted = decrypt(encrypted, key) // 原文
```

### 非对称加密

通常使用一对密钥来进行加解密。有两种情况：

1. 公钥加密私钥解密，就是用于一般的加密保证数据安全性。
2. 私钥加密公钥解密，用于身份认证判断某个用户的真实性（签名）。

RSA是一个常用的非对称加密算法。

### 数字签名和消息认证

数字签名实际上就是用私钥进行加密（签名），公钥进行解密（验证）。

数字签名和在真实世界的签名一样，一但签名经由你的手发生，意味着以下几个信息：

1. 内容生效，通常不得再更改（不可否认）。
2. 内容发生对象确定，也就是你本人（真实性）。
3. 内容已经被你确定（完整性）。

### 随机数

如果没有随机数，每次加密时生成的密文都是一样的，加密时输入随机数会让每次加密的密文不一样增加安全性。

初始化向量(IV)就是一种随机数。

需要注意的是：所有的软件中的随机数都是伪随机数，因此伪随机数的随机性显得尤为重要。

随机数通常并不像密钥那样保密。

### 混淆

混淆不只是密码学中的概念，它本质上是指使事物变得不可理解或者难以理解的一种方式。

混淆通常就是改变排列方式和置换原文。

比如现代前端代码都经由构建工具打包，生成的JS代码被压缩后通常都是难以阅读的，因为压缩就是原文置换的一种，因此你可以认为这种压缩过的代码就是混淆过的代码。

现代防盗（比如某些小说网站）大量地使用到了混淆，这也是你看某些dao ban小说会出现奇怪乱码的原因。

### 长度

经常会看到AES-128, SHA-256之类的数字，有以下几种指代：

1. 生成的密文长度
2. 密钥的长度
3. 加密区块的长度

这些数字准确地来讲都是8的倍数，8的单位是bit，8bit就是一个字节的长度，像AES-128实际上就是指的生成128位也即16字节长度的密文，并且加密密钥也需要使用16字节长度的密钥，区块长度也为16字节，甚至原文数据也要是128的倍数（不满足的会进行填充）。

### 填充
在密码学中，填充（padding）是指在加密算法中对数据进行补位的过程。填充通常用于确保待加密的数据长度符合特定的加密算法要求。

我们不需要了解不同的填充方法，只要加解密时填充保证填充方式一致即可。

## 加密算法

### 哈希函数

哈希函数，或者叫散列函数，是一种将任何一种数据输出为固定长度数据（哈希值）的一种方法， 由于输出的数据通常要比输入的数据短得多，因此输出值又被叫做摘要。哈希函数有以下特点：

1. 哈希函数是不可逆的，无法通过哈希值还原到原来的数据。
2. 理想情况下，每个不同的输入数据都会输出不同的哈希值。
3. 生成的哈希值长度固定。

根据上面的特点，我们可以用哈希函数来校验文件的完整性和唯一性，完整性用来判别文件是否经过篡改，唯一性的则可以用来做文件秒传断点续传等功能。



#### MD5

早期很多下载软件有一个校验文件MD5的按钮（没错，那是病毒肆虐的年代），用于校验文件的完整性，以避免你下载了什么盗版软件或者病毒，有些游戏软件安装包在下载时会损坏，同样也有md5校验来检验完整性。可见， MD5的应用其实时很广泛的。但MD5已经被证明不够安全，因此使用它可能导致数字签名被伪造，密码泄露等严重问题。 不过用来做数据
