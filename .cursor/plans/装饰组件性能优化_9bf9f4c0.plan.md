---
name: 装饰组件性能优化
overview: ""
todos:
  - id: ink-particles
    content: 用纯 CSS 动画重写 InkParticles.vue，移除 Canvas 和 requestAnimationFrame
    status: completed
  - id: ink-background
    content: 优化 InkBackground.vue：降低模糊强度，移除噪点滤镜，简化动画
    status: completed
  - id: cloud-patterns
    content: 优化 CloudPatterns.vue：移除 feTurbulence/feDisplacementMap 滤镜
    status: completed
  - id: brush-strokes
    content: 优化 BrushStrokes.vue：移除复杂 SVG 滤镜
    status: completed
  - id: seal-stamp
    content: 简化 SealStamp.vue：移除复杂滤镜和 hover 动画
    status: completed
  - id: solar-terms
    content: 优化 SolarTerms.vue：缓存节气计算结果
    status: completed
  - id: layout-global
    content: 在 CatKitLayout 添加条件渲染和 prefers-reduced-motion 支持
    status: pending
---

# CatKitLayout 装饰组件性能优化方案

## 概述

对 [`docs/.vitepress/theme/CatKitLayout.vue`](docs/.vitepress/theme/CatKitLayout.vue) 及其子装饰组件进行性能优化，消除 CPU/内存占用飙升的问题，同时尽可能保留视觉效果。

## 核心优化策略

### 策略 1: 用 CSS 动画替代 Canvas/JS 动画

Canvas + requestAnimationFrame 是主要性能瓶颈。CSS 动画可被 GPU 加速，且在页面不可见时自动暂停。

### 策略 2: 移除或简化 SVG 复杂滤镜

`feTurbulence` 和 `feDisplacementMap` 是极其消耗性能的滤镜。用静态效果或纯 CSS 替代。

### 策略 3: 使用 `prefers-reduced-motion` 媒体查询

尊重用户的系统设置，减少动画对性能敏感用户的影响。

### 策略 4: 添加可见性检测

使用 Intersection Observer，只在组件可见时运行动画。---

## 逐组件优化方案

### 1. InkParticles.vue - 彻底重写 (最高优先级)

**问题**：Canvas + requestAnimationFrame + mousemove 监听**方案**：用纯 CSS 粒子替代

```css
/* 伪代码示意 */
.particle {
  animation: float 20s linear infinite;
  will-change: transform, opacity;
}
```



- 使用 10-15 个 `<div>` 元素代替 Canvas 粒子
- 使用 CSS `@keyframes` 实现漂浮效果
- 移除鼠标交互（或使用极低频率的 throttle）
- 使用 `will-change: transform` 启用 GPU 加速

### 2. InkBackground.vue - 简化模糊效果

**问题**：`filter: blur(40px)` 极其消耗 GPU**方案**：

- 将 `blur(40px)` 降至 `blur(20px)` 或更低
- 使用 `backdrop-filter` 替代（部分场景）
- 减缓或暂停 `breathe` 动画，改为 hover 触发或一次性动画
- 移除 SVG `feTurbulence` 噪点，改用 CSS `background-image` 静态噪点

### 3. CloudPatterns.vue - 移除复杂滤镜

**问题**：`feTurbulence + feDisplacementMap` 计算量巨大**方案**：

- 完全移除 `filter="url(#cloud-texture)"`
- 保留云朵形状的渐变效果
- 减慢或移除浮动动画，改为一次性进入动画

### 4. SealStamp.vue - 简化滤镜

**问题**：多重复杂 SVG 滤镜**方案**：

- 移除 `seal-noise` 和 `rough-paper` 滤镜
- 保留印章图形本身
- 移除 hover 脉冲动画（或改为 CSS transition）

### 5. BrushStrokes.vue - 移除复杂滤镜

**问题**：同样的 `feTurbulence + feDisplacementMap`**方案**：

- 移除 `filter="url(#brush-texture)"`
- 保留笔画描边动画（`stroke-dashoffset` 动画性能可接受）
- 动画改为一次性执行，不无限循环

### 6. SolarTerms.vue - 轻度优化

**问题**：相对较轻，但仍有优化空间**方案**：

- 将节气计算移至构建时或使用 `useMemo` 缓存
- 动画保持一次性执行

---

## 全局优化

### 在 CatKitLayout.vue 中添加条件渲染

```vue
<template #home-hero-before v-if="frontmatter.layout === 'home'">
  <!-- 只在首页渲染这些装饰 -->
</template>
```



### 添加 `prefers-reduced-motion` 支持

```css
@media (prefers-reduced-motion: reduce) {
    * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
  }
}
```